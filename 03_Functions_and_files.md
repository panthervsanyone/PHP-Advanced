# Урок 3. Файлы, функции

## Файлы

Работа с файлами состоит из трех этапов:  

1. Открытие файла.
2. Манипуляции с данными.  
3. Закрытие файла.

### Открытие файла

Для открытия файла используется функция **fopen**. Параметрами функции является имя файла и режим открытия файла. Функция возвращает дескриптор файла, который позволяет в дальнейшем работать с уже открытым файлом.

```php
$file = fopen('file.txt', 'r+');
```
 
- **r** – открытие файла только для чтения
- **r+** – открытие файла одновременно на чтение и запись
- **w** – создание нового пустого файла. Если на момент вызова уже существует такой файл, то он уничтожается
- **w+** - аналогичен r+, только если на момент вызова файл такой существует, его содержимое удаляется
- **a** – открывает существующий файл в  режиме записи, при этом указатель сдвигается на  последний байт файла (на конец файла)
- **a+** - открывает файл в режиме чтения и записи при этом указатель сдвигается на последний байт файла (на конец файла). Содержимое файла не удаляется

### Работа с данными файла

**`fgets()`** используется для чтения строк из файла, принимает один обязательный и один необязательный параметр. Первый параметр - обработчик файла, file handler, который создается функцией `fopen`. Второй параметр - количество символов.

**`fwrite()`** применяется для записи в файл. У нее есть три параметра: обязательный file handler, обязательный параметр "что писать в файл", и необязательный - указание количества символов.

Файл так же можно прочитать сразу весь, в массив, при помощи функции **`file()`**. Эта функция принимает единственный параметр - имя файла, и не требует handler-а.

При помощи **`feof()`** с единственным параметром handler можно проверить, закончился ли файл.

### Закрытие файла

Файл закрывается вызовом функции **`fclose()`**, принимающей единственным параметром хэндлер файла.

### Пример работы с файлами
Задача. Перенести с файла counter.txt текст в файл file.txt. Вывести результат. Закрыть файл
```php
//читаем файл в массив  
$file_array = file('counter.txt');
//открытие файла
$file = fopen('file.txt', 'a+');
//проверка, не закончился ли файл
//чтение из файла
fwrite($file, $file_array[0]);
$s = fgets($file);
echo $s;

//закрытие файла
fclose($file);
```
 
Чтобы ознакомиться с другими функциями работы с файлами, перейдите по ссылке ниже.
[Все функции для работы с файлами](http://www.php.su/articles/?cat=fs&page=005)

## Функции php

Функцией называется фрагмент программного кода, обладающий уникальным именем и предназначенный для решения конкретной задачи. Функция вызывается по имени в разных точках программы, что позволяет многократно выполнять фрагмент с указанным именем. Преимущество такого решения заключается в том, что блок кода пишется всего один раз, а затем легко модифицируется по мере необходимости. 

Функции могут создаваться в любой точке программ PHP. 
Можно разместить все функции, используемые сценарием, в самом начале сценарного файла. 
Лучше выделить функций в отдельный файл (называемый библиотекой). 

Определение функции обычно состоит из трех частей: 
* имени функции; 
* круглых скобок, в которых перечисляются необязательные входные параметры, разделенные запятыми; 
* тела функции, заключенного в фигурные скобки. 
```php
function имя_функции ([$параметр1. $параметр2, .... $параметрn]) { 
	тело функции 
}
```


## Пользовательские функции
Определили функцию:
```php
<?php
  function hello() {
    echo "Привет из функции";
    return true;
  }
?>
```
! Без return можно, но не нужно.

Вызвали функцию:
```php
<?php
  // вызов функции
  hello();
?>
```
Передали данные в функцию:
```php
<?php
  function hello($my_name) {
    echo "Привет $my_name !!!";
    return 1;
  }
   $name = “Nick”;
   hello($name);
?>
```

## Написание своей функции
Возвращает значение из функции конструкция return:
```php
function myFunc($n){
	return $n*$n;
}
$kvadrat = myFunc(2);
// теперь переменная $kvadrat = 4
```
В отличии от C можно возвращать любой тип данных, включая массивы.
Сразу несколько значений функция вернуть не может, но вполне можно сложить несколько данных в ассоциативный массив и вернуть его. 
Если в функции нет конструкции return, то считается что функция вернула NULL (по умолчанию).
Но лучше стараться всегда что-то возвращать функцией, как правило хорошего тона.
Если нечего возвращать, напишите:  
```php
return true;
```
Встретив в теле функции конструкцию return интерпретатор далее функцию не выполняет, только возвращает значение.


## Параметры по умолчанию
```php
<?php
  function hello($name, $surname = “Ivanovich” ) {
    echo "Привет $name $surname !!!";
    return 1;
  }

   $name = “Nick”;
   hello($name);
?>
```
Если при вызове функции ей передать необязательный параметр, то она его использует. Если не передать, то функция использует значение из своего объявления (значение по умолчанию)

Если мы объявляем функцию с параметрами по умолчанию, то вначале должны идти обязательные параметры, а потом не обязательные.
Следующий код будет не корректен:
```php
<?php 
	function hello($name = 'Mike', $h){ 
		echo "<h$h>Hello, $name!</h$h>"; 
	} // Код не корректен 
?> 
```
Здесь при вызове функции я уже не могу пропустить первый параметр, а он у нас не обязательный, то есть, я не могу записать вызов функции так:
```php
<?php 
	hello( , 1); 
	// Ошибка 
?>
```
## Переменное число параметров

Иногда бывает удобно передавать любое количество переменных в функцию. К примеру что бы вывести каждую строковую переменную применив к ним какое-либо форматирование:
**ВАЖНО:
Можно задавать при вызове функции больше параметров, чем описано в функции. Лишние просто проигнорируются. 
Но меньше задавать НЕЛЬЗЯ.**
```php
function myecho(){ 
        for($i=0; $i<func_num_args(); $i++){
            echo func_get_arg($i) . "<br>\n";
        }
        //можно использовать foreach
} 
//выведем отформатированные строки
myecho("First sentenc!!!", "Second sentenc!!!", "Third sentence!!!");
```
Функции для доступа к «лишним» параметрам:
* **int func_num_args()** – возвращает общее число аргументов, переданных функции.
* **mixed func_get_arg(int $num)** – возвращает значение аргумента с номером $num, заданного при вызове функции (начиная с 0).
* **list func_get_args()** – возвращает список всех аргументов, указанных при вызове функции


## Ссылки
Ссылки в PHP - это средство доступа к содержимому одной переменной под разными именами.
Жесткая ссылка представляет собой просто переменную, которая является синонимом другой переменной. Многоуровневые ссылки (то есть, ссылка на ссылку на переменную, как это можно делать, например, в Perl) не поддерживаются. Так что не стоит воспринимать жесткие ссылки серьезнее, чем синонимы.Чтобы создать жесткую ссылку, нужно использовать оператор & (амперсанд). Например:
```php
$a=10;
$b = &$a; 
// теперь $b — то же самое, что и $a
$b=0; 
// на самом деле $a=0
echo "b=$b, a=$a"; 
// Выводит: "b=0, a=0»
```
Ссылаться можно не только на переменные, но и на элементы массива:
```php
$A=array('a' => 'aaa', 'b' => 'bbb');
$b=&$A['b']; 
// теперь $b — то же, что и элемент с индексом 'b' массива
$b=0; 
// на самом деле $A['b']=0;
echo $A['b']; // Выводит 0
```
Впрочем, элемент массива, для которого планируется создать символическую ссылку, может и не существовать. Как в следующем случае:
```php
$A = array('a' => 'aaa', 'b' => 'bbb');
$b = &$A[‘с'];
// теперь $b — то же, что и элемент с индексом 'c' массиваecho "Элемент с индексом 'c': (".$A['c'].")";
```
В результате выполнения рассмотренного скрипта, хотя ссылке $b и не было ничего присвоено, в массиве $A создастся новый элемент с ключом c и значением — пустой строкой. 
То есть, жесткая ссылка на самом деле не может ссылаться на несуществующий объект, а если делается такая попытка, то объект создается.
Примечание: Если убрать строку, в которой создается жесткая ссылка, то будет выведено сообщение о том, что элемент с ключом c не определен в массиве $A.

## Удаление ссылки

При удалении ссылки, просто разрывается связь имени и содержимого переменной. Это не означает, что содержимое переменной будет разрушено:
```php
$a = 1;
$b =& $a;
unset($a); 
```
Этот код не сбросит $b, а только $a.
Переменная $a, но которую ссылается переменная $b удалится. Но значение, которое было в $b на момент удаления $a так и останется.
Фактически $b станет независимой переменной.
```php
unset($b); 
```
Теперь получается что удалится только $b (ссылка на $a). Сама переменная $a при этом не пострадает.

## Передача параметров по ссылке
Если необходимо разрешить функции изменять переданные аргументы за ее пределами, вы должны передавать их по ссылке. 
Для того, чтобы аргумент был передан по ссылке, необходимо указать знак & (амперсанд) перед именем параметра в определении функции:
```php
function foo(&$my_color) {  
     // теперь параметр будет ссылаться на оригинальное значение
     $my_color = 'синий';      
      // присваиваем новое значение
  }
  $color = 'красный';
  foo($color);
  echo $color;    // выведет: синий


function funct(&$string){
	$string .= 'а эта внутри.';
}
$str = 'Эта строка за пределами функции, ';
funct($str);echo $str;    
// Выведет 'Эта строка за пределами функции, а эта внутри.'
```













Программист часто использует встроенные функции языка, и часто пишет свои. Функции языка выглядят как имя функции, за которой в скобках идут параметры функции. 

`результат = имя_функции(параметр1, параметр2...)`

Как правило, функция возвращает какое-то значение в ответ.

Примеры некоторых полезных функций:

```php
$var = 12;

//функция is_int() проверяет, является ли ее параметр целым числом. 
//Возвращает true, если целое число, false, если нет.
echo is_int($var);

//Функция isset($var) проверяет, определена ли переменная
if (isset($var)) echo "It is set"; 

//Функция empty($var) проверяет, не пустая ли переменная
if ( ! empty($var)) echo "It is not empty"; 

//Функции print_r и var_dump осуществляют более подробный вывод
var_dump($var);
print_r($var);
```

## Описание встроенной функции php

Подробное рассмотрение мануала по любой встроенной функции php покажет нам ее описание, подобное следующему:

`int intval ( mixed $var [, int $base = 10 ] )`

Это [описание](http://php.net/manual/ru/function.intval.php) функции intval в официальной документации php.
В данном описании функции лева направо: 

* **int** - тип возвращаемого функцией значения. Если void - функция ничего не возвращает.
* **intval** - имя функции.
* **mixed** - тип аргумента. В данном случае - смешанный тип, т.е. возможны разные типы.
* $**var** - аргумент, который передается в функцию.
* **[int $base]** - в квардатных скобках указывается необязательный аргумент. Если перед ним написан тип - то при его передаче тип должен соблюдаться.
* **$base = 10** - если после аргумента идет присвоение ему значения - это его значение по умолчанию. Если аргумент не был передан, ему присваивается значение по умолчанию.

Таким образом из описания выше мы видим, что функция intval возвращает целое число, получает в качестве аргумента один обязательный аргумент смешанного типа и один необязательный, по умолчанию равный десяти.

По ссылке довольно неплохая подборка [встроенных функций](http://site-on.net/create/php/13-built-in-functions).

## Написание своей функции

```php
<?php
function by_tens($number) {
    $i = 10;
    while ($i <= $number) {
        echo "$i\n";
        $i += 10;
    }
    return true;
}
by_tens(120);
}
```

Функция создается с помощью зарезервированного слова **`function`**. Затем следует имя функции, затем в скобках перечень аргументов функции. После закрывающей скобки перечня аргументов следует блок операторов, аналогичный блоку в **`if`** или **`while`**.

Другое зарезервированное слово, важное для создания функций - слово **`return`**. В теле функции может встречаться сколько угодно операторов **`return`**. Если выполняется **`return`**, функция завершает свою работу, возвращая результат вычисления выражения, переданного **`return`**, как результат работы функции.

Параметры, которые мы передаем в функцию, могут быть ссылочными:

```php
function addFive($num) {
    $num += 5;
}

function addSix(&$num) {
    $num += 6;
}

$orignum = 10;

addFive($orignum);
echo "Original Value is $orignum"; //10

addSix($orignum);
echo "Original Value is $orignum"; //16
```

[Домашнее задание](03_homework.md)

[Четвертый Урок](04_Strings_and_arrays.md)
